# LedgerAlpha 深度迭代建议报告 v47.0

## 1. 核心反思与自我诊断
在前六轮迭代中，我们完成了核心链路、安全、审计和报告导出的建设。第七轮迭代聚焦于“预测引擎”的深度化与“系统稳定性”的细节打磨：
1. **现金流预测的粗粒度**：目前的 `CashflowPredictor` 仅使用简单的日均值，未考虑合同约定的未来应付/应收款项。
2. **审计规则的配置化**：`AuditorAgent` 的审计红线（如 10w 大额风控）目前是硬编码，缺乏灵活性。
3. **数据库并发冲突**：在极端高频写入下，SQLite 的 `EXCLUSIVE` 锁定可能导致 `Collector` 丢弃任务。

## 2. 本轮优化建议 (10项)
1. **[预测层] 引入“合同感知型”现金流预测**：支持从 `transactions` 备注或专门的合同表中提取未来特定日期的收支。
2. **[审计层] 实现审计阈值的动态配置化**：将 `force_manual_amount` 等参数移至 `settings.yaml`。
3. **[运维层] 增加 `MasterDaemon` 的子进程内存监控熔断**：防止 `OpenManus` 等推理进程内存泄漏挂掉整机。
4. **[基建层] 完善 `DBHelper` 的事务重试算法**：引入随机抖动 (Jitter) 的指数退避。
5. **[安全层] 强化 `PrivacyGuard` 的“三层脱敏”逻辑**：区分本地、内网与外网的不同脱敏级别。
6. **[存储层] 增加 `system_events` 表**：记录系统核心状态变更（如熔断、重启、规则晋升）。
7. **[引擎层] 增强科目匹配的“季节性”权重**：如年末自动提升“年终福利”类科目的权重。
8. **[交互层] 支持“一键回滚”交互指令**：在 `InteractionHub` 中实现对误确认分录的快照恢复。
9. **[性能层] 优化 OCR 结果的缓存命中率**：基于文件哈希跳过重复识别。
10. **[文档层] 补充“影子银企直连”安全沙箱配置手册**：指导用户如何配置 Playwright 凭据。

## 3. 本轮执行计划 (Action Taken)
1. **修改 `cashflow_predictor.py`**：引入更严谨的波动率计算，并预留“未来合同项”解析接口。
2. **修改 `auditor_agent.py`**：将硬编码的风险阈值改为从 `ConfigManager` 读取。
3. **修改 `main.py`**：增加对子进程内存占用的实时监控逻辑。
4. **更新迭代记录**：同步更新 `iteration_count.txt`。

---
迭代时间：2025-03-24
执行人：无敌大旋风 (Iteration Cycle #7)
