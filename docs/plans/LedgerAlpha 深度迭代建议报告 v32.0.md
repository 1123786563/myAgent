# LedgerAlpha 深度迭代建议报告 v32.0

## 1. 深度反思与现状评估
系统已在 Round 30 和 31 中补齐了税务哨兵、影子分录识别及知识自进化闭环。但在“经营洞察”与“穿透式证据链”这两个核心功能点上仍处于雏形阶段：
- **经营洞察交付（F3.3.4）**：`exporter.py` 目前仅支持基础的 CSV/JSON 导出，缺乏对“投融资标准包”这类高附加值报告的支持。
- **现金流预测（F3.3.3）**：`cashflow_predictor.py` 尚未与导出模块联动，用户无法获得持久化的预测报告。
- **穿透式证据链（F3.2.4）**：数据库 `transactions` 表缺乏对推理逻辑（Reasoning Path）的结构化存储，导致审计溯源性弱。
- **配置一致性（L1）**：`accounting_agent.py` 加载规则时缺乏对“灰度规则”的主动优先级处理。
- **多维核算支持（F3.2.3）**：目前的导出和记录逻辑尚未深度集成 `project_tags`，无法满足微小企业按项目核算损益的需求。

## 2. 五项优化建议

### 建议 1：重构 `Exporter` 以支持“投融资标准包”模版 (F3.3.4)
- **目标**：实现从原始分录到标准银行融资报告的自动化转化。
- **动作**：在 `exporter.py` 中引入 `InvestReportGenerator` 类，支持生成包含损益表、资产负债表（模拟）及现金流预测的 Markdown/PDF 报告。

### 建议 2：将 `CashflowPredictor` 与报告系统联动 (F3.3.3)
- **目标**：预测结果不再仅存于内存或日志，而是作为财务月报的一部分持久化。
- **动作**：修改 `CashflowPredictor.predict`，使其能输出结构化数据供 `Exporter` 调用。

### 3. 建议 3：实现“穿透式证据链”存储结构 (F3.2.4)
- **目标**：确保每笔账目都能溯源至推理日志。
- **动作**：在 `DBHelper` 中为 `transactions` 表新增 `inference_log` (TEXT) 字段，并在 `AccountingAgent` 中填入详细推理路径。

### 4. 建议 4：在 `AccountingAgent` 中引入“灰度优先”逻辑 (L1)
- **目标**：确保新学习（GRAY）的知识在冲突时具备可解释性或特定的优先级策略。
- **动作**：加载规则时，按 `audit_level` 和 `priority` 复合排序。

### 5. 建议 5：完善 `DBHelper` 的多维核算架构 (F3.2.3)
- **目标**：支持分录按“项目/部门”打标签。
- **动作**：新增 `transaction_tags` 表，实现一对多标签关联。

---

## 3. 本轮执行计划 (Round 32)
1. **升级 `DBHelper.py`**：新增 `inference_log` 字段及 `transaction_tags` 关联表。
2. **优化 `Exporter.py`**：初步实现“投融资标准报告”生成器。
3. **记录变更至 `docs/plans/优化迭代记录_Round32.md`**。
