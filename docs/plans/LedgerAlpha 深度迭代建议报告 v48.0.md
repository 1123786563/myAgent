# LedgerAlpha 深度迭代建议报告 v48.0

## 1. 核心反思与自我诊断
在前七轮迭代中，我们完成了核心架构、审计状态机、成本熔断、交互卡片、并发匹配及资源监控的建设。第八轮迭代聚焦于“架构解耦”与“鲁棒性增强”：
1. **信号处理的局限性**：目前的 `signal_handler.py` 过于简单，仅能处理基础退出，缺乏对 `SIGUSR1` (任务快照) 或 `SIGUSR2` (日志级别动态调整) 的支持。
2. **多线程安全隐患**：`DBHelper` 的局部连接虽然通过 `threading.local()` 隔离，但在长连接模式下缺乏“活性检测”。
3. **分录生成的影子回馈**：当老板修正科目后，系统应当自动触发一个“影子学习任务”来验证该修正是否与现行准则冲突。

## 2. 本轮优化建议 (10项)
1. **[运维层] 实现日志级别动态调整**：通过监听 `SIGUSR2` 信号，在不重启的情况下动态切换 DEBUG/INFO 模式。
2. **[架构层] 引入“任务快照”机制**：监听 `SIGUSR1` 信号，实时导出当前内存中所有服务的任务堆栈到 `logs/snapshot.json`。
3. **[基建层] 增加数据库连接的“活性探测” (Keep-alive)**：在每次获取连接前执行 `SELECT 1` 校验。
4. **[流程层] 完善 HITL 修正的“准则冲突检测”**：当 `InteractionHub` 收到修正时，在入库前触发审计 Agent 校验。
5. **[安全层] 增加导出报表的数字水印 (Digital Watermark)**：在 PDF 或 MD 报告中隐藏导出 ID 追踪。
6. **[存储层] 实现 `inference_logs` 的异步批次刷盘**：减少高频写操作对事务锁定的压力。
7. **[性能层] 引入 `MatchEngine` 的索引预热机制**：系统启动时自动加载高频供应商索引。
8. **[交互层] 支持“一键诊断”指令**：通过 IM 发送 `/status` 获取 `MasterDaemon` 的实时心跳大盘。
9. **[运维层] 增加磁盘 IO 等待率监控**：当 IO 负载过高时主动调大 `poll_interval`。
10. **[可靠性] 强化 `Collector` 对大文件写入中(Writing-in-progress)的跳过逻辑**：防止读取到不完整的文件。

## 3. 本轮执行计划 (Action Taken)
1. **修改 `signal_handler.py`**：接入 `SIGUSR1` 和 `SIGUSR2` 监听，实现动态运维。
2. **修改 `db_helper.py`**：在 `_get_conn` 中增加连接活性检测逻辑。
3. **修改 `collector.py`**：增加文件锁定检查，防止读取正在写入的文件。
4. **更新迭代记录**：同步更新 `iteration_count.txt`。

---
迭代时间：2025-03-24
执行人：无敌大旋风 (Iteration Cycle #8)
