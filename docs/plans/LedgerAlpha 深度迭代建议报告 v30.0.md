# LedgerAlpha 深度迭代建议报告 v30.0

## 1. 深度反思与现状评估
基于《需求规格说明书 v4.0》与《详细设计说明书 v4.0》的对齐检查，当前代码库（src/）已具备基础的采集、审计和主控逻辑，但在“三位一体”架构的深度融合上仍有以下缺失：
- **影子审计（F3.2.2）**：目前仅为单点校验，缺乏异构模型的对冲验证。
- **税务哨兵（F3.3.1）**：功能完全缺失，尚未实现模拟金税四期的巡检逻辑。
- **银企直连（F3.1.4）**：采集端仅支持本地文件监听，缺乏主动流水获取能力。
- **高级推理（OpenManus）**：`manus_wrapper.py` 仍处于 Mock 阶段。
- **知识回流（F3.4.2）**：缺乏明确的“灰度规则”管理机制。

## 2. 五项优化建议

### 建议 1：实现 `SentinelAgent` 税务合规哨兵 (F3.3.1)
- **目标**：模拟金税四期逻辑，对入账分录进行实时合规性巡检。
- **动作**：新建 `src/sentinel_agent.py`，实现税负率监控、进销项匹配度校验。

### 建议 2：升级 `AuditorAgent` 为多维审计 (F3.2.2)
- **目标**：实现异构审计逻辑，而非简单的正则和金额校验。
- **动作**：引入置信度阈值联动，对低置信度任务强制触发“影子会计”二次校验。

### 3. 建议 3：完善 `KnowledgeBridge` 灰度管理 (F3.4.2)
- **目标**：实现规则的“育种-灰度-转正”生命周期。
- **动作**：在 `knowledge_bridge.py` 中增加规则权重与成功计数器，只有通过 3 次审计的规则才进入核心 SOP。

### 4. 建议 4：强化 `Collector` 的“影子预匹配”能力 (F3.1.2)
- **目标**：在发票到达前通过银行流水（模拟）生成预记账条目。
- **动作**：增加 `Collector` 对银行流水文件的解析支持，并能触发 `MatchEngine` 进行“消消乐”匹配。

### 5. 建议 5：将 `ManusWrapper` 实装化 (L2 推理)
- **目标**：当 L1 (Moltbot) 无法处理时，调用更强的 LLM 接口进行深度背景调研。
- **动作**：接入 OpenClaw 的 `web_search` 或高级模型接口。

---

## 3. 本轮执行计划 (Round 30)
1. **新建 `src/sentinel_agent.py`**：初步实现税务巡检框架。
2. **优化 `src/auditor_agent.py`**：增强审计逻辑。
3. **记录变更至 `docs/plans/优化迭代记录_Round30.md`**。
