# LedgerAlpha 优化建议 (Round 41) - v4.7 深度协同与合规进化

基于对核心文档（白皮书、需求规格说明书）的最新研读，以及对系统在“三位一体”架构下协同效率的反思，针对审计深度、路由智能、税务决策及系统稳健性，提出以下 5 个深度优化建议：

## 1. 落地“行业感知”审计规则库 (Sector-Aware Audit)
*   **优化背景**：目前的红方审计（Red-Team Audit）规则较为通用，缺乏对细分行业（如零售、软件、餐饮）特定合规风险的捕捉。
*   **建议内容**：在 `AuditorAgent` 中引入行业模板。根据 `ConfigManager` 中配置的企业行业属性，动态加载针对性的审计规则（如软件行业的研发加计扣除专项检查）。
*   **技术实现**：重构 `auditor_agent.py` 的规则加载逻辑，支持行业模板注入。
*   **价值**：大幅提升审计的专业性，使智能体更贴近资深行业会计的水平。

## 2. 增强“动态路由”自学习降级机制 (Adaptive Routing)
*   **优化背景**：现有的 `RoutingRegistry` 主要是静态配置，无法根据 L1 处理的历史失败记录自动调整路由。
*   **建议内容**：建立“路由冷却池”。若某个供应商在 L1 层连续出现低置信度（<0.8）处理，自动将其加入“高阶观察名单”，在接下来的 N 笔交易中强制路由至 L2。
*   **技术实现**：升级 `routing_registry.py`，增加 `feedback_loop` 接口接收处理结果。
*   **价值**：实现“智能分流”，避免在已知难点上反复浪费 L1 的 Token 并导致处理延迟。

## 3. 实现“主动税务筹划”建议引擎 (Tax Strategy Advisor)
*   **优化背景**：目前的模拟报税仅能算出“缴多少”，无法告知用户“怎么省”。
*   **建议内容**：升级 `SentinelAgent`。当检测到月度营收接近小规模纳税人免税临界点（如 10 万/30 万）时，主动推送策略卡片（如：建议部分延迟开票或增加合规进项）。
*   **技术实现**：在 `sentinel_agent.py` 的 `_calculate_projected_tax` 中增加阈值预测逻辑。
*   **价值**：从“记账工具”进化为“经营助手”，显著提升产品的商业溢价。

## 4. 补全“多模态资产”真实聚合逻辑 (True Multi-modal Merging)
*   **优化背景**：Round 40 实现了 `group_id` 的打标，但 L2 推理时仍未真正合并同组信息。
*   **建议内容**：在 `ManusWrapper` 中实现 `aggregate_group_context`。在处理属于同一 `group_id` 的单据时，合并其 OCR 结果和视觉描述，生成一份统一的“资产画像”。
*   **技术实现**：重构 `manus_wrapper.py` 的调查逻辑，支持传入 batch 上下文。
*   **价值**：解决“一物多影”产生的碎片化描述问题，实现资产入账的“神形合一”。

## 5. 建立“数据库自愈”定期维护任务 (DB Maintenance)
*   **优化背景**：随着账本规模增大，SQLite 的 WAL 文件和碎片可能影响查询响应速度。
*   **建议内容**：在 `MasterDaemon` 中注册定期维护心跳。执行 `wal_checkpoint`、`ANALYZE` 和 `VACUUM`。
*   **技术实现**：在 `main.py` 的 metrics 更新周期中加入维护任务逻辑。
*   **价值**：确保系统在高负载、长周期运行下的响应时延（F5 验收标准）。

---
建议提交人：无敌大旋风 (LedgerAlpha 首席架构小狗)
日期：2026-01-31
