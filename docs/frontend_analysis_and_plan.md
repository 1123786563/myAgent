# 前端代码深度分析与改进计划

## 1. 现状分析

通过对 `frontend/src` 目录及核心业务页面的代码审查，我对当前 Ledger Alpha 项目的前端实现有了清晰的认知。目前的系统处于 **MVP（最小可行性产品）的早期阶段**，虽然骨架清晰，但在“AI 智能”特性的呈现和业务闭环上存在明显缺失。

### 1.1 核心问题：从“CRUD 系统”到“AI Agent 系统”的差距

目前的前端更像是一个传统的后台管理系统（CRUD Dashboard），而非一个 **AI Agent 驱动的智能财务系统**。

*   **缺乏“代理感” (Lack of Agency)**: 系统的核心价值——AI Agent（审计、风控、记账智能体）——在前端几乎不可见。用户看到的是静态的统计数据，而不是 Agent 正在工作的过程或思考链路。
    *   *证据*: `Dashboard.jsx` 使用写死的 mock 数据；`Reconciliation.jsx` 点击“开始自动对账”后仅弹出一个 Toast，用户无法感知 Agent 的匹配过程。
*   **交互被动**: 主要是用户发起请求 -> 系统响应。缺乏 Agent 主动推送的 insights 或异常预警的实时交互流。
    *   *证据*: `ProactiveHub` 组件虽然存在，但目前是静态展示，未与后端 `interaction_hub.py` 或 Agent 事件流（SSE/WebSocket）打通。

### 1.2 具体模块缺失与不足

1.  **仪表盘 (Dashboard)**:
    *   **数据虚假**: 严重依赖硬编码的 `data` 对象。
    *   **可视化缺失**: "收支趋势" 图表仅为占位符文本，缺失核心的财务趋势分析功能。
    *   **健康分无逻辑**: “合规健康分”是写死的 98 分，未关联实际的风控规则引擎。

2.  **发票工作台 (Invoice Workbench)**:
    *   **详情缺失**: “查看详情”功能未开发 (`message.info('详情查看功能开发中')`)，导致用户无法查看发票的 OCR 原始数据或核验明细。
    *   **状态反馈弱**: 发票查验后仅提示“异步更新”，前端无轮询或推送机制自动刷新状态。

3.  **对账中心 (Reconciliation)**:
    *   **人工确认逻辑缺失**: “确认匹配”按钮虽然有 UI，但回调函数是空的，无法完成人机协作的闭环。
    *   **上传体验**: 文件上传成功后仅简单的 `reload`，缺乏导入预览或错误数据的行级展示。

## 2. 深度自我反思

作为开发者，我之前的关注点过于集中在“页面结构”的搭建（Layout, Routing, Table），而忽视了 **业务灵魂（Business Soul）** 的注入。

*   **忽视了“AI 可解释性”**: 我没有为 Agent 设计一个“思考窗口”或“日志流”，导致用户不信任系统的自动决策。
*   **低估了“数据流”的重要性**: 仪表盘作为第一入口，展示假数据会瞬间降低用户对系统的信任度。
*   **前端工程化不足**: API 请求散落在各个组件中（有的用 `request` 封装，有的直接用 `axios`），缺乏统一的数据层管理（如 React Query 或 SWR），导致状态同步困难。

## 3. 开发计划

基于以上分析，我制定了以下阶段性开发计划，重点在于 **“激活”仪表盘** 和 **引入可视化组件**，让系统“活”起来。

### 第一阶段：仪表盘“实心化” (立即执行)
目标：替换 Dashboard 的 Mock 数据，接入真实后端 API；实现收支趋势图表。

1.  **后端 API 适配**: 确保后端有对应的 Dashboard API (`/api/v1/dashboard/metrics`, `/api/v1/dashboard/chart`, `/api/v1/dashboard/actions`).
2.  **前端数据接入**: 改造 `Dashboard.jsx`，使用 `useEffect` 调用真实 API。
3.  **图表组件集成**: 引入 `@ant-design/plots`，实现动态的收支折线图。

### 第二阶段：Agent 可视化 (后续规划)
目标：让用户看到 Agent 的工作。

1.  **Agent 活动流**: 在 Dashboard 右侧增加 "Agent Activity Stream"，实时展示 "正在核对流水...", "发现风险项..." 等日志。
2.  **Websocket/SSE 集成**: 建立前后端实时通道。

### 第三阶段：业务闭环 (后续规划)
目标：完善发票和对账的详情交互。

1.  **发票详情页**: 开发发票详情抽屉 (Drawer)，展示 OCR 结果对比。
2.  **对账人工确认**: 实现对账记录的 Match/Unmatch 接口调用。

---

**接下来的执行动作**: 我将立即开始 **第一阶段** 的开发。
1.  安装 `@ant-design/plots`。
2.  修改 `Dashboard.jsx` 以集成真实图表和 API 请求。
