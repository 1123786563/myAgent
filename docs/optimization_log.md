# 数据库迁移日志: SQLite 到 PostgreSQL

## 1. 迁移概述
本项目已完成从 SQLite 到 PostgreSQL 的架构兼容性改造。系统现在支持通过环境变量自动切换数据库后端。

## [2026-02-01] “破釜沉舟”式清理：彻底移除 SQLite

### 变动说明
为了简化架构并充分利用 PostgreSQL 的高级特性（如 `JSONB`, `GIS` 等），本项目决定彻底移除对 SQLite 的支持。这不仅是代码逻辑的精简，也是生产环境向更稳健、高并发架构的全面倾斜。

### 核心改动
- **代码清理**: 
    - 移除了 `src/core/db_base.py`、`src/core/db_helper.py`、`src/core/db_transactions.py`、`src/core/db_queries.py` 等文件中所有对 `sqlite3` 的导入和 `if DB_TYPE == "sqlite"` 的条件判断。
    - PostgreSQL 现已成为硬编码的唯一支持后端。
    - 统一了 SQL 占位符为 `%s`。
    - 删除了针对 SQLite 的语法补丁（如 `strftime` 替换为 PG 的 `extract` 或 `date_trunc`）。
- **文件清理**: 
    - 物理删除了项目根目录及 `src` 目录下的所有 `.db` 文件。
- **依赖优化**:
    - 在 `requirements.txt` 中显式添加了 `psycopg2-binary`。
- **环境要求**:
    - 必须在运行环境配置有效的 PostgreSQL 环境变量，否则系统将无法初始化数据库连接。

### 遗留注意事项
- 以后再无 `ledger_alpha.db` 可用，请确保本地开发环境已启动 PostgreSQL 实例。

---
*Generated by DB Purge Subagent*

## [2026-02-01] Docker 基础环境搭建

### 变动说明
为 LedgerAlpha 项目提供了完整的 Docker 容器化支持，实现了应用、数据库和缓存服务的一键式部署。

### 核心改动
1. **多阶段构建 Dockerfile**:
    - **Builder 阶段**: 安装构建工具 (`gcc`, `libpq-dev`) 并安装 Python 依赖。
    - **Runtime 阶段**: 使用轻量级镜像，仅包含运行环境，提升安全性并减小镜像体积。
2. **Docker Compose 配置**:
    - **app 服务**: 运行 LedgerAlpha 核心应用，支持健康检查。
    - **db 服务**: 采用 PostgreSQL 15 镜像，配置持久化卷 (`postgres_data`)。
    - **redis 服务**: 引入 Redis 7 提供缓存支持，配置持久化卷 (`redis_data`)。
    - **网络隔离**: 所有服务运行在独立的 `ledger_network` 中。
3. **环境变量管理**:
    - 提供了 `.env.example` 模板文件，规范化配置管理。
4. **自动化脚本**:
    - 创建了 `scripts/start_docker.sh`，自动处理 `.env` 初始化并启动容器环境。

### 使用说明
1. **一键启动**: 运行 `./scripts/start_docker.sh`。
2. **停止环境**: 运行 `docker-compose down`。
3. **查看日志**: 运行 `docker-compose logs -f app`。

---
*Generated by Dockerization Subagent*
