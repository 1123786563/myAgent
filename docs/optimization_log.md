# 数据库迁移日志: SQLite 到 PostgreSQL

## 1. 迁移概述
本项目已完成从 SQLite 到 PostgreSQL 的架构兼容性改造。系统现在支持通过环境变量自动切换数据库后端。

## 2. 核心改动
- **db_base.py**: 重构了连接池与事务管理器，支持 `psycopg2` (Postgres) 和 `sqlite3` (SQLite)。
- **db_initializer.py**: 增加了 PostgreSQL 的 Schema 初始化逻辑，处理了自增主键 (`SERIAL`)、触发器函数和视图语法的差异。
- **db_transactions.py**: 兼容了占位符 (`%s` vs `?`)、日期函数和冲突处理 (`ON CONFLICT`) 的语法差异。
- **db_helper.py**: 抽象了底层执行逻辑，统一了不同后端的接口行为。

## 3. 环境配置
在 `.env` 文件中配置以下项以启用 PostgreSQL：
```env
DB_TYPE=postgres
POSTGRES_HOST=your_host
POSTGRES_PORT=5432
POSTGRES_USER=your_user
POSTGRES_PASSWORD=your_password
POSTGRES_DBNAME=ledger_alpha
```
默认情况下，如果 `DB_TYPE` 未设置或设置为 `sqlite`，系统将继续使用本地 SQLite 数据库。

## 4. 注意事项
- **依赖安装**: 需确保环境中安装了 `psycopg2-binary`。
- **性能优化**: 在 Postgres 模式下，事务处理更稳健，支持更高并发。
- **兼容性测试**: 已通过 SQLite 模式下的回归测试。由于当前环境暂无可用 PG 实例，PG 模式已完成代码级适配。

---
*Generated by DB Migrator Subagent*
