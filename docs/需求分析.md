# LedgerAlpha 需求分析报告 (整合版)

## 1. 文档信息
- **项目名称：** LedgerAlpha (微小企业全自动、自进化记账智能体系统)
- **版本：** v1.4 (PM 竞品分析与功能深化版)
- **负责人：** 无敌大旋风
- **状态：** 已整合 PRD v1.1-v1.3、白皮书、行业竞品（Zeni, Digits, Expensify）调研建议
- **日期：** 2026-01-31

---

## 2. 产品定义与定位
本项目旨在构建一个具备会计思维的全自动数字员工。通过 **AgentScope (稳健基建)** + **Moltbot (高效SOP)** + **OpenManus (强推理探索)** 构建“三位一体”架构，实现从票据采集到报表生成的全链路自动化与知识自进化。
**核心愿景：** 让 AI 不仅仅是记账工具，更是老板的“经营助手”与“税务哨兵”。

---

## 3. 核心战略：三大框架融合 (The Trinity Strategy)

系统通过分层治理实现降本增效，并引入“推理分级”机制。

### 3.1 框架角色定位与职责升级

| 框架名称 | **AgentScope** | **Moltbot** | **OpenManus** |
| :--- | :--- | :--- | :--- |
| **核心定位** | **基建底座 / 风险审计官** | **SOP 执行者 / 效率会计** | **智能探索者 / 策略分析师** |
| **主要职责** | 1. **“影子会计”多重审计**：实现 A 记账 B 审计的互校验机制。<br>2. **会计红线硬阻断**：严防 AI 幻觉导致的违规操作。<br>3. 会计科目自进化白名单管理。 | 1. **90% 常规任务处理 (Low-Cost)**：通过轻量化模型处理基础单据。<br>2. **IM 寄生交互**：在微信/飞书端实现“对话即记账”。<br>3. 预定义 SOP 与流水线作业。 | 1. **疑难杂症攻坚 (High-Intelligence)**：处理复杂合同与异常单据。<br>2. **经营洞察与预警**：生成“现金流天气预报”及税务合规分析。<br>3. 多模态分析与浏览器自动化。 |

---

## 4. 核心功能模块分析 (深化版)

### 4.1 智能流式采集舱 (The Collector)
- **多渠道监听**：自动监控本地、邮箱、IM 文件流。
- **预记账匹配 ( Brex/Ramp 模式)**：监听银行短信/邮件，在发票到达前生成“待补全分录”，实现秒级消消乐匹配。
- **多模态实物关联**：自动根据照片识别资产类型并生成卡片。支持多图语义聚合，识别空间连续性。
- **长上下文全局追溯**：利用长上下文能力进行跨年度账目一致性审计。
- **自愈式知识库**：自动检测规则冲突，并定期进行知识压缩。

### 4.2 语义化记账引擎 (The Ledger Engine)
- **穿透式证据链**：报表数字可点击，直接溯源至原始 OCR 截图、OpenManus 推理逻辑及审计日志。
- **项目成本归集**：基于语义自动给单据打标签（如“XX项目”），自动输出项目损益表。
- **影子银企直连**：浏览器自动化实现本地化流水抓取。

### 4.3 税务风险与合规雷达 (The Sentinel)
- **金税四期主动防御**：定期巡检账目进销项匹配度，输出“税务局视角”的风险预警告知书。
- **政策参数化**：OpenManus 实时抓取并转化最新减税降费政策。

### 4.4 经营分析与交付机器人 (The Reconciler)
- **现金流天气预报**：基于历史支出规律与待付合同，预测未来资金状况。
- **投融资标准包一键生成**：将非结构化账目自动整理为符合银行贷款/机构融资标准的结构化报告。
- **行业 Benchmarking**：利用联网能力对比同行业财务指标。
- **税务“模拟报税”沙箱**：基于实时账目生成模拟纳税申报表，让用户提前感知税负，并提供合规避税建议。

### 4.5 对标 QuickBooks 的深度增强
- **生态集成 (Integration Ecosystem)**：通过 API 接入微小企业常用的电商平台（Shopify）、支付系统（Stripe/PayPal）及薪酬系统，消除数据孤岛。
- **实物资产与进销存管理 (Stock Agent)**：引入专门的库存 Agent，监听入库/出库单，实现进销存与会计分录的自动化对冲。
- **主动式证据追索**：检测到无票交易时，通过 IM 自动发送语音/文本提示（如：“老板，刚才那笔 300 元餐费请拍照”）。
- **多维度核算模型**：支持部门、门店、产品线、业务员等通用的多维度统计。
- **版本控制与回溯 (Versioning)**：建立“账本快照”机制，支持在 AI 自动调整后的“一键回滚”至历史节点。

### 4.6 深度经营分析与自动化合规 (基于 QuickBooks 深度拆解优化)
- **智能供应商洞察 (Vendor Intelligence)**：自动分析单一供应商采购频率与价格波动，预警异常涨价或潜在供应链风险。
- **自动对账“消消乐” (Auto-Reconciliation)**：模拟 QuickBooks 的匹配引擎，通过浏览器自动化抓取网银流水，并与账面分录进行语义匹配，识别“金额一致但日期冲突”的疑难杂症。
- **税务“哨兵”体检 (Tax Sentinel)**：模拟专业税务审计，定期生成合规性评分，预测增值税临界点风险。
- **知识回流“灰度期”管理**：OpenManus 学习的新规则设为 `PENDING_REVIEW`，确保自进化系统的稳定性。

---

## 5. 技术架构与安全性 (强化)

### 5.1 推理分级机制 (Cost Optimization)
- **L1 (Local/Mini)**: 处理 90% 基础单据，极致压缩 Token 成本。
- **L2 (Strong LLM)**: 仅在异常路由或高风险（L3 风险）触发时激活 OpenManus。
- **成本看板**: 展示 AI 帮老板节省的 Token 和人工费用。

### 5.2 “影子会计”校验逻辑
- 每个分录必须通过 AgentScope 触发的二次异构校验（不同 Prompt 或模型），差异点强制人工介入。

---

## 6. 风险分级与异常处理

| 风险等级 | 处理策略 | 典型场景 |
| :--- | :--- | :--- |
| **低风险 (L1)** | 自动入账，生成经营摘要。 | 日常办公、小额打车费。 |
| **中风险 (L2)** | 资产/合同关联，需老板一键确认。 | 跨期合同、固定资产采购。 |
| **高风险 (L3)** | **强制审计/红线阻断/人工复核。** | **大额转账、无票支出、税务预警偏离、未知供应商。** |

---

## 7. 非功能需求 (NFR)

- **稳定性**：AgentScope 负责组件隔离与自动重启。
- **成本优化**：通过成本阈值管理，对低价值任务限制强推理调用频次。
- **事务一致性**：确保会计分录写入的原子性。

---

## 8. 附录：核心交互伪代码 (v1.4)

```python
class LedgerAlphaSystem:
    def __init__(self):
        self.scope = AgentScope.Manager()   # 影子审计与安全屋
        self.moltbot = Moltbot.Worker()    # IM 交互与低成本 SOP
        self.manus = OpenManus.Analyst()   # 经营预测与税务哨兵

    def handle_incoming_stream(self, data):
        # 1. 预记账匹配逻辑
        if is_bank_notification(data):
            return self.scope.create_pending_entry(data)

        # 2. 推理分级选择
        score = self.moltbot.quick_classify(data)
        if score > 0.95:
            result = self.moltbot.process(data) # L1 推理
        else:
            analysis = self.manus.deep_analyze(data) # L2 强推理
            result = self.scope.verify_with_shadow_agent(analysis) # 影子审计

        # 3. 证据链固化
        return self.scope.finalize(result, data.original_source)

---
迭代记录：v3.0 同步更新 [2025-03-24]
```