# LedgerAlpha 全局配置
path:
  base_dir: "."
  workspace: "workspace"
  input: "workspace/input"
  db: "ledger_alpha.db"
  rules: "src/core/accounting_rules.yaml"
  audit_rules: "src/core/audit_rules.yaml"
  logs: "logs"

intervals:
  daemon_poll: 10
  collector_scan: 60
  match_engine_loop: 30
  retry_backoff_base: 2
  recovery_scan: 60              # [Iteration 8] 自愈扫描间隔 (秒)
  sighup_debounce: 5             # [Iteration 8] SIGHUP 防抖时间 (秒)
  shutdown_grace_period: 10      # [Iteration 8] 进程关闭宽限期 (秒)
  max_backoff_wait: 300          # [Iteration 8] 最大退避等待时间 (秒)

db:
  retry_count: 3
  retry_delay: 0.5
  wal_size_warning_mb: 100       # [Iteration 8] WAL 文件大小告警阈值 (MB)

threshold:
  confidence_high: 0.95
  confidence_low: 0.5
  token_budget_per_task: 2.0
  semantic_match_min: 0.7        # [Iteration 8] 语义匹配最低阈值
  semantic_match_high: 0.8       # [Iteration 8] 语义高置信度阈值
  capex_amount: 5000             # [Iteration 8] 资本支出金额分界线
  micro_payment_waiver: 50       # [Iteration 8] 微额支付豁免阈值
  risk_score_reject: 0.15        # [Cycle 2] 审计直接驳回阈值
  risk_score_upgrade: 0.4        # [Cycle 2] 审计强制升级阈值
  price_outlier_factor: 1.5      # [Cycle 2] 价格偏离基准系数

# [Optimization Iteration 2] LLM 配置
llm:
  type: "OPENAI"                                    # OPENAI | MOCK
  base_url: "http://127.0.0.1:8045/v1"             # OpenAI 兼容 API 地址
  api_key: "sk-b175f35fa7c34888a26da2daf42c1bf3"   # API 密钥
  model: "gemini-3-flash"                           # 模型名称
  max_retries: 3                                    # 最大重试次数
  timeout: 30                                       # 请求超时 (秒)
  temperature: 0.3                                  # 生成温度 (0-1)

agents:
  accounting:
    model: "gpt-4o-mini"
    default_confidence: 0.95     # [Iteration 8] 默认置信度
    fallback_confidence: 0.7     # [Iteration 8] 回退置信度
  auditor:
    model: "gpt-4o"
  manus:
    model: "gpt-4o"

collector:
  worker_threads: 3
  initial_scan_enabled: true
  batch_buffer_size: 100         # [Iteration 8] 批量缓冲区大小
  flush_interval: 30             # [Iteration 8] 刷新间隔 (秒)
  file_grouping_window: 300      # [Iteration 8] 文件分组时间窗口 (秒)
  min_file_size: 10              # [Iteration 8] 最小文件大小 (字节)

audit:
  outlier_factor: 5.0
  force_manual_amount: 100000

tax:
  free_limit_monthly: 100000
  target_burden: 0.03

enterprise:
  sector: "SOFTWARE"

# [Iteration 8] API 服务配置
api:
  expose_errors: false           # 是否在响应中暴露详细错误信息
  rate_limit_window: 60          # 限流时间窗口 (秒)
  rate_limit_max: 100            # 普通端点最大请求数
  auth_rate_limit_max: 10        # 认证端点最大请求数

# 认证与授权配置
auth:
  jwt_secret_key: "${LEDGER_AUTH_JWT_SECRET}"  # JWT 密钥 (生产环境必须通过环境变量设置)
  jwt_algorithm: "HS256"
  jwt_issuer: "ledger-alpha"
  access_token_expire_minutes: 15    # 访问令牌有效期 (分钟)
  refresh_token_expire_days: 7       # 刷新令牌有效期 (天)

  # 密码策略
  password_min_length: 8
  password_require_uppercase: true
  password_require_number: true
  password_require_special: false
  bcrypt_rounds: 12

  # 账户安全
  max_failed_login_attempts: 5       # 最大登录失败次数
  account_lockout_minutes: 30        # 账户锁定时间 (分钟)

bank_mapping:
  default:
    vendor_col: "对方户名"
    amount_col: "金额"
    date_col: "交易日期"
    encoding: "utf-8-sig"
